const cartilhaContent = {
    apresentacao: {
        titulo: "Apresentação",
        conteudo: `A Secretaria de Estado de Meio Ambiente - SEMA/MT, por meio de sua Superintendência de Educação Ambiental tem como principal objetivo informar a todos, de forma simples e clara, como podem contribuir para a conservação da biodiversidade do nosso Estado.

Acreditamos que esta Cartilha disponibilizará conhecimentos à população sobre a legislação ambiental, possibilitando a atuação efetiva dos mato-grossenses na proteção do meio ambiente.

A cartilha faz parte de um jogo educativo que apresenta informações sobre a forma legal de realizar a disposição correta dos resíduos sólidos, proteção florestal e dos recursos pesqueiros.

<div class="section-title">Elaboração:</div>
- Elaine Corsini - Analista de Meio Ambiente 
- Victória de M. Arruda da Costa - Analista de Meio Ambiente

<div class="section-title">Diagramação:</div>
- Beatriz Mikulski da Silva - Estagiária 
- Victória de M. Arruda da Costa - Analista de Meio Ambiente

<div class="section-title">Desenvolvimento do Jogo Digital:</div>
- Guilherme Justiniano da Silva
- João Heitor Kozow Bittencourt Bertoloto
- Kauan Douglas de Matos Barbosa
- Keven Eduardo Vaz Bilibio
- Matheus Henrique Lôbo Alves
- Rafael de Lima Almeida

Secretaria de Estado de Meio Ambiente de Mato Grosso
Fique legal com o Meio Ambiente

Contato: susa@sema.mt.gov.br`
    },
    pesca: {
        titulo: "Pesca Legal",
        conteudo: `Pescar apenas em local e período permitido

Para mantermos a saúde dos rios e a reprodução dos peixes, é fundamental respeitar os locais e períodos de pesca permitidos.

Carteira de Pescador Amador ou Pescador Profissional
Ao pescar, não se esqueça de portar a carteira que comprova sua permissão para a atividade.

Peixes fora da medida
Se você pescar um peixe que não está dentro da medida permitida, devolva-o imediatamente ao rio. Essa atitude garante a reprodução da espécie e a alegria de outros pescadores no futuro.

Menores de 18 anos
Se você tem menos de 18 anos, fique tranquilo! Você também pode pescar, desde que esteja acompanhado dos pais ou responsáveis e tenha a autorização necessária.

Período de defeso (Piracema)
Você sabe o que é o período de defeso? É quando a pesca é proibida para proteger os peixes durante a reprodução. Em Mato Grosso, a piracema acontece de outubro a janeiro.

Modalidades de pesca permitidas
Em Mato Grosso, existem diversas modalidades de pesca permitidas, como a científica, amadora, profissional artesanal, desportiva, profissional, de subsistência e subaquática. Informe-se sobre cada uma delas e escolha a que mais se adequa às suas necessidades e preferências.

<div class="section-title">Utilize a tabela abaixo como guia e pratique a pesca consciente:</div>

<h4>Peixes e suas Medidas (cm):</h4>
- Bicuda: 60
- Caranha: 45
- Chimburé: 25
- Dourada: 80
- Jáu: 95
- Matrinxã: 35
- Pirapitinga: 45
- Pirarara: 90
- Piau: 25
- Piraputanga: 30
- Barbado: 60
- Cachara: 80
- Cachorra: 60
- Curimbatá: 30
- Jurupensém: 35
- Pacu-peva: 45
- Pintado do Paraguai: 40
- Placa do Paraguai: 45
- Plavuçu: 200

O que não é legal na pesca:

É proibido:
- Pescar no período de defeso (piracema)
- Pescar e transportar peixes abaixo da medida mínima e acima da quantidade permitida, ou sem a carteirinha de pescador
- Capturar iscas vivas e de peixes nativos para fins ornamentais e de aquariofilia, a 1.000 metros de ninhais (Lei nº 9.096/2009)
- Pescar com substâncias tóxicas ou explosivos
- Pescar por meio de derivação de cursos d'água ou esgotamento de lagos de domínio público
- Fazer cevas fixas permanentes ou com uso de equipamentos mecânicos irregulares para pescaria colocados no leito do rio
- Capturar, comercializar e transportar as espécies Dourado e Piraíba ou Filhote no estado de Mato Grosso
- Pescar a 200 metros abaixo ou acima de barragens, corredeiras, cachoeiras e escadas de peixes e desembocadura de baías
- Pescar no interior das Unidades de Conservação`
    },
    queimadas: {
        titulo: "Queimadas e Incêndios Florestais",
        conteudo: `Um dos grandes problemas que assolam Mato Grosso todos os anos são as queimadas e os incêndios florestais. Descubra o que fazer para a proteção das florestas.

O que não é legal em relação às queimadas:

- Realizar queimadas no período proibitivo, do dia 1º de julho a 31 de outubro, por ser o período mais seco do ano a aumentar o risco de incêndios florestais
- É expressamente proibido fazer qualquer queimada sem autorização
- Queimar vegetação nativa
- Queimar Área de Reserva Legal - ARL
- Queimar Área de Preservação Permanente - APP
- Causar incêndios florestais (fogo sem controle)
- A queimada no perímetro urbano é proibida durante todo o ano

Recomendações importantes:
- Faça sempre o aceiramento para evitar que o fogo acabe queimando as áreas de preservação permanente, reservas legais e áreas de uso restrito
- A queima em canaviais e em restos de explorações florestais (desmatamento) só poderão ser realizadas com autorização prévia da SEMA
- Não utilizar fogo para manejar o seu solo, busque técnicas alternativas

Consequências das queimadas e dos incêndios:
- Alteração na qualidade do ar
- Aumento dos casos de doenças respiratórias
- Redução da biodiversidade e do habitat da fauna e flora silvestres
- Redução da fertilidade dos solos
- Aumento da emissão de gases de efeito estufa para a atmosfera
- Fechamento de estradas e aeroportos em função da baixa visibilidade
- Aumento do risco de acidentes
- Morte de animais silvestres`
    },
    vegetacao: {
        titulo: "Proteção da Vegetação",
        conteudo: `<div class="section-title">São Áreas de Preservação Permanente - APP</div>

<div class="section-subtitle">Todo córrego ou rio deve ter uma faixa de vegetação nativa (APP) em suas margens, o tamanho da faixa varia conforme a largura do curso d'água:</div>

- Cursos d'água de menos de 10 metros de largura: APP de 30 metros
- Cursos d'água de 10 a 50 metros de largura: APP de 50 metros
- Cursos d'água de 50 a 200 metros de largura: APP de 100 metros
- Cursos d'água de 200 a 600 metros de largura: APP de 200 metros
- Cursos d'água acima de 600 metros de largura: APP de 500 metros

As lagoas e lagos naturais devem ter uma faixa de vegetação em seu entorno (APP) de:
- Em zonas rurais: 100 metros
- Em zonas urbanas: 30 metros
- Lagos ou reservatórios artificiais: definido pela licença ambiental

Outras APPs importantes:
- Nascentes e olhos d'água: raio mínimo de 50 metros
- Encostas com declividade superior a 45º
- Bordas de tabuleiros ou chapadas: mínimo de 100 metros
- Veredas: mínimo de 50 metros
- Topo de morros, montes, montanhas e serras com altura mínima de 100 metros e inclinação média maior que 25º

O que não é legal na APP:
- Desmatar Áreas de Preservação Permanente
- Substituir a vegetação original por espécies exóticas
- Construir em áreas de APP
- Utilizar as áreas de APP para agricultura, pecuária ou criação de outros animais
- Barrar os cursos d'água sem autorização da SEMA

Importância das APPs:
- Fonte de alimento para peixes
- Manutenção da qualidade e quantidade da água
- Fonte de abrigo e alimentação para a fauna silvestre
- Corredores ecológicos para fauna
- Manutenção da biodiversidade
- Evita a contaminação dos cursos d'água
- Manutenção do lençol freático`
    },
    reservalegal: {
        titulo: "Reserva Legal",
        conteudo: `A Reserva Legal - RL é uma área localizada no interior de uma propriedade rural, onde deve ser mantida a vegetação nativa, tendo como objetivo: promover a conservação da biodiversidade, proteção de fauna silvestre e da flora nativa.

Como calcular a Reserva Legal:
- Propriedades em áreas de floresta: 80% da área do imóvel
- Propriedades em áreas de cerrado: 35% da área do imóvel
- Propriedades com mais de um tipo de vegetação: considerar os percentuais de cada tipo

O que não é legal na Reserva Legal:
- Realizar desmatamento e queimada
- Explorar madeira sem aprovação na SEMA
- Substituir a vegetação nativa por vegetação exótica
- Modificar a destinação da Reserva Legal em caso de venda da propriedade

Área de Uso Restrito - AUR:
São de dois tipos:
1. Pantanais e planícies pantaneiras
2. Áreas de inclinação entre 25º e 45º

O que não é legal na AUR:
- Realizar desmatamento da vegetação nativa
- Obstruir ou desviar rios, lagoas, corixos e vazantes
- Realizar drenagem dos campos inundáveis
- Introduzir espécies exóticas
- Realizar aterros e escavações nas áreas inundáveis`
    },
    residuos: {
        titulo: "Resíduos Sólidos",
        conteudo: `Todos nós produzimos diariamente uma grande quantidade de resíduos sólidos (lixo), e à medida que a população cresce, este volume aumenta ainda mais, demandando cada vez mais áreas maiores para a disposição desses resíduos.

A Política dos 5 Rs do Ministério do Meio Ambiente:
- REPENSAR - Ter um consumo consciente
- RECUSAR - Avaliar produtos e recusar embalagens não recicláveis
- REDUZIR - Gerar menos resíduos e evitar desperdícios
- REUTILIZAR - Dar novo uso aos materiais
- RECICLAR - Transformar materiais usados em novos produtos

Dicas para aplicar os 5 Rs:
- Não compre o que você não precisa
- Dê preferência a produtos que tem refil
- Evite produtos descartáveis
- Leve sua sacola ao supermercado
- Guarde seu lixo até encontrar onde descartar corretamente
- Doe roupas e sapatos ao invés de jogar no lixo
- Compre alimentos na quantidade necessária
- Use correio eletrônico
- Imprima usando os dois lados do papel

O que não é legal fazer com os Resíduos Sólidos:
- Jogar lixo nas ruas e rios
- Jogar lixo em terrenos baldios
- Queimar resíduos sólidos
- Descartar incorretamente pilhas, baterias, lâmpadas e aerossóis
- Jogar eletrônicos no lixo comum

A solução está nas mãos de cada um de nós. Pratique o consumo consciente e a destinação correta dos resíduos!`
    }
};

function showCartilha() {
    const modal = document.createElement('div');
    modal.id = 'cartilhaModal';
    modal.className = 'modal';
    modal.style.display = 'block'; // Garantir que o modal seja visível
    
    // Prevenir scroll do body quando a cartilha estiver aberta
    document.body.style.overflow = 'hidden';
    
    const content = document.createElement('div');
    content.className = 'modal-content cartilha-content';
    
    const closeBtn = document.createElement('button');
    closeBtn.className = 'close-button';
    closeBtn.innerHTML = '&times;';
    closeBtn.onclick = (e) => {
        e.preventDefault();
        e.stopPropagation();
        modal.style.display = 'none';
        modal.remove();
        document.body.style.overflow = ''; // Restaurar scroll do body
    };
    
    // Melhorar manipulação de eventos touch
    modal.addEventListener('touchmove', (e) => {
        if (e.target === modal) {
            e.preventDefault(); // Prevenir scroll do background
        }
    }, { passive: false });
    
    // Fechar modal quando clicar fora do conteúdo
    modal.addEventListener('click', (e) => {
        if (e.target === modal) {
            modal.style.display = 'none';
            modal.remove();
            document.body.style.overflow = '';
        }
    });
    
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && modal.parentElement) {
            modal.style.display = 'none';
            modal.remove();
            document.body.style.overflow = '';
        }
    });
    
    const nav = document.createElement('nav');
    nav.className = 'cartilha-nav';
    
    Object.keys(cartilhaContent).forEach(section => {
        const btn = document.createElement('button');
        btn.textContent = cartilhaContent[section].titulo;
        btn.onclick = () => showSection(section);
        nav.appendChild(btn);
    });
    
    const sectionContent = document.createElement('div');
    sectionContent.className = 'cartilha-section';
    
    content.appendChild(closeBtn);
    content.appendChild(nav);
    content.appendChild(sectionContent);
    modal.appendChild(content);
    
    document.body.appendChild(modal);
    showSection('apresentacao'); // Mostrar primeira seção por padrão
}

function showSection(sectionId) {
    const sectionContent = document.querySelector('.cartilha-section');
    const section = cartilhaContent[sectionId];
    const buttons = document.querySelectorAll('.cartilha-nav button');
    
    // Atualizar botão ativo
    buttons.forEach(btn => {
        btn.classList.remove('active');
        if (btn.textContent === section.titulo) {
            btn.classList.add('active');
        }
    });

    // Formatar o conteúdo para melhor apresentação
    let formattedContent = section.conteudo
        // Formatar listas numeradas: identifica linhas iniciadas com dígitos e ponto
        .replace(/^\s*\d+\.\s*(.+)$/gm, '<li class="numlist">$1</li>')
        // Formatar listas com hífen
        .replace(/^- (.+)$/gm, '<li>$1</li>')
        // Envolver itens numerados com <ol>
        .replace(/((?:<li class="numlist">.*<\/li>\n?)+)/g, '<ol>$1</ol>')
        // Envolver demais listas com <ul>
        .replace(/((?:<li>(?!class).*<\/li>\n?)+)/g, '<ul>$1</ul>')
        // Formatar subtítulos com marcadores coloridos
        .replace(/^([A-Z][^:\n]+):$/gm, '<h3><span class="section-marker marker-blue">•</span>$1</h3>')
        // Formatar subtítulos normais (sem marcador)
        .replace(/^([^-\n<][^:\n]+):$/gm, '<h4>$1:</h4>')
        // Destacar dicas
        .replace(/^DICA:(.*)$/gim, '<div class="tip-box">💡 Dica:$1</div>')
        // Destacar alertas
        .replace(/(!importante:.*$)/gim, '<div class="alert-box">⚠️ Importante:$1</div>')
        // Destacar informações
        .replace(/(Observação:.*$)/gim, '<div class="important-box">ℹ️ Observação:$1</div>')
        // Destacar palavras-chave entre asteriscos
        .replace(/\*([^*]+)\*/g, '<span class="emphasis">$1</span>')
        // Formatar parágrafos
        .replace(/\n\n/g, '</p><p>')
        // Destacar números e medidas com limites de palavra
        .replace(/\b(\d+(?:\s*(?:metros|cm|%|anos))?)\b/g, '<strong>$1</strong>')
        // Formatar títulos de seção com marcador azul
        .replace(/<div class="section-title">([^<]+)<\/div>/g, '<h3><span class="section-marker marker-blue">•</span>$1</h3>');

    // Envolver em parágrafos se ainda não estiver
    if (!formattedContent.startsWith('<p>')) {
        formattedContent = `<p>${formattedContent}</p>`;
    }

    // Nova estrutura de formatação para a cartilha
    sectionContent.innerHTML = `
    <article class="cartilha-article fade-in">
        <header class="cartilha-article-header">
            <h2>${section.titulo}</h2>
        </header>
        <div class="cartilha-text">
            ${formattedContent}
        </div>
        <footer class="cartilha-article-footer">
            <p>Fonte: Secretaria de Estado de Meio Ambiente de Mato Grosso</p>
        </footer>
    </article>
    `;

    // Scroll suave para o topo ao mudar de seção
    sectionContent.scrollTo({
        top: 0,
        behavior: 'smooth'
    });
}
